{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    <link rel="icono" href="{% static 'logo.png' %}">
    <script src="https://kit.fontawesome.com/eb496ab1a0.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'plantilla.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
</head>
<body>
  
    <nav class="navbar navbar-expand-lg bg-dark">
        <div class="container-fluid">
          <img src="{% static 'logo3.png' %}" alt="" width="130" height="70">
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="nav justify-content-center">
              <li class="nav-item">
                
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="{% url 'Home' %}" style="color:#fff;" >Inicio</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:#fff;" >
                  Ayuda
                </a>
                <ul class="dropdown-menu">

                  <li><a class="dropdown-item" href="{% url 'Documentacion' %}">Documentación</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{% url 'Home' %}">Salir</a></li>   
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <br>

      <button type="button" class="btn btn-primary" onclick="showClientes()">Clientes</button>
      <a href="{% url 'Productos' %}" class="btn btn-primary">Productos</a>
      <a href="{% url 'Factura' %}" class="btn btn-primary">Factura</a>
      <button type="button" class="btn btn-danger"><a href="{% url 'Inicio' %}" style="text-decoration: none; color: white;">Regresar</a></button>

    <div class="mb-3" id="file-upload-section" style="display: none;">
        <label for="formFile" class="form-label">Cargar archivo de entrada</label>
        <input class="form-control" type="file" id="formFile" style="width: 21.5%; display: inline-block;">
        <button onclick="exportar('clientes-tabla.xml')">Exportar a XML</button>
    </div>
    
    <div class="col-12 button-container" id="additional-buttons-section" style="display: none;">
        <button type="button" class="btn btn-success" onclick="consultarDatos()">Consultar datos</button>
    </div>

    <div id="clientes-section" class="crear-cliente" style="display: none; padding: 20px;">
      <h2>Crear Cliente</h2>
      <form onsubmit="addRow(); return false;">
          <label for="nombre">Nombre:</label><br>
          <input type="text" id="nombre" name="nombre"><br>
          <label for="nit">NIT:</label><br>
          <input type="text" id="nit" name="nit"><br>
          <label for="direccion">Dirección:</label><br>
          <input type="text" id="direccion" name="direccion"><br>
          <label for="mail">Correo Electrónico:</label><br>
          <input type="text" id="mail" name="mail"><br>
          <label for="phone">Teléfono:</label><br>
          <input type="text" id="phone" name="phone"><br>
          <label for="id">ID:</label><br>
          <input type="text" id="id" name="id"><br>
          <input type="submit" value="Crear Cliente">
      </form>

      <div class="table-responsive">
          <table class="table" id="clientes-table">
              <thead>
                  <tr>
                      <th>ID</th>
                      <th>NIT</th>
                      <th>Nombre</th>
                      <th>Correo Electrónico</th>
                      <th>Teléfono</th>
                      <th>Dirección</th>
                      <th>Acciones</th>
                  </tr>
              </thead>
              <tbody id="clientes-tbody"></tbody>
          </table>
      </div>
  </div>

  <div id="cliente-1-update-section" class="update-section" style="display: none;">
      <h2>Actualizar Cliente</h2>
      <form onsubmit="updateRow('cliente-1'); return false;">
          <label for="update-id">ID:</label><br>
          <input type="text" id="update-id" name="id"><br>
          <label for="update-nit">NIT:</label><br>
          <input type="text" id="update-nit" name="nit"><br>
          <label for="update-nombre">Nombre:</label><br>
          <input type="text" id="update-nombre" name="nombre"><br>
          <label for="update-mail">Correo Electrónico:</label><br>
          <input type="text" id="update-mail" name="mail"><br>
          <label for="update-phone">Teléfono:</label><br>
          <input type="text" id="update-phone" name="phone"><br>
          <label for="update-direccion">Dirección:</label><br>
          <input type="text" id="update-direccion" name="direccion"><br>
          <input type="submit" value="Actualizar">
      </form>
  </div>

  <script>
        
      function addRow() {
          var nuevoId = document.getElementById('id').value;
          var nuevoNit = document.getElementById('nit').value;
          var nuevoNombre = document.getElementById('nombre').value;
          var nuevoMail = document.getElementById('mail').value;
          var nuevoPhone = document.getElementById('phone').value;
          var nuevaDireccion = document.getElementById('direccion').value;

          if (!nuevoId || !nuevoNit || !nuevoNombre || !nuevoMail || !nuevoPhone || !nuevaDireccion) {
              alert('Todos los campos son obligatorios');
              return;
          }

          var table = document.getElementById('clientes-table');
          var newRow = table.insertRow(table.rows.length);
          var cell1 = newRow.insertCell(0);
          var cell2 = newRow.insertCell(1);
          var cell3 = newRow.insertCell(2);
          var cell4 = newRow.insertCell(3);
          var cell5 = newRow.insertCell(4);
          var cell6 = newRow.insertCell(5);
          var cell7 = newRow.insertCell(6);

          newRow.id = 'cliente-' + (table.rows.length - 1);  
      
          cell1.innerText = nuevoId;
          cell2.innerText = nuevoNit;
          cell3.innerText = nuevoNombre;
          cell4.innerText = nuevoMail;
          cell5.innerText = nuevoPhone;
          cell6.innerText = nuevaDireccion;
      
          cell7.innerHTML = '<button onclick="showUpdateForm(\'' + newRow.id + '\')">Editar</button>' +
              '<button onclick="deleteRow(\'' + newRow.id + '\')">Eliminar</button>';
      
          var editButton = cell7.querySelector('button:nth-child(1)');
          var deleteButton = cell7.querySelector('button:nth-child(2)');
      
          editButton.onclick = function () {
              showUpdateForm(newRow.id);
          };
          
          deleteButton.onclick = function () {
              deleteRow(newRow.id);
          };
      
          alert('Cliente agregado exitosamente');
      
          document.getElementById('id').value = '';
          document.getElementById('nit').value = '';
          document.getElementById('nombre').value = '';
          document.getElementById('mail').value = '';
          document.getElementById('phone').value = '';
          document.getElementById('direccion').value = '';
      }
      
      function addRowToTable(id, nit, nombre, mail, phone, direccion, index) {
        
          var table = document.getElementById('clientes-table');
          var tbody = table.getElementsByTagName('tbody')[0];
          var newRow = tbody.insertRow(tbody.rows.length);
          var cell1 = newRow.insertCell(0);
          var cell2 = newRow.insertCell(1);
          var cell3 = newRow.insertCell(2);
          var cell4 = newRow.insertCell(3);
          var cell5 = newRow.insertCell(4);
          var cell6 = newRow.insertCell(5);
          var cell7 = newRow.insertCell(6);
      
          newRow.id = 'cliente-' + index;
      
          cell1.innerText = id;
          cell2.innerText = nit;
          cell3.innerText = nombre;
          cell4.innerText = mail;
          cell5.innerText = phone;
          cell6.innerText = direccion;
      
          cell7.innerHTML = '<button onclick="showUpdateForm(' + index + ')">Editar</button>' +
          '<button onclick="deleteRow(\'' + newRow.id + '\')">Eliminar</button>';

      }



  </script>

      
  </div>

  <script>
    function showUpdateForm(clienteId) {
      var index = clienteId.split('-')[1];
      var row = document.getElementById(clienteId);

          
          var id = row.cells[0].innerText;
          var nit = row.cells[1].innerText;
          var nombre = row.cells[2].innerText;
          var mail = row.cells[3].innerText;
          var phone = row.cells[4].innerText;
          var direccion = row.cells[5].innerText;
          var index = clienteId.split('-')[1];

         
          document.getElementById('update-id').value = id;
          document.getElementById('update-nit').value = nit;
          document.getElementById('update-nombre').value = nombre;
          document.getElementById('update-mail').value = mail;
          document.getElementById('update-phone').value = phone;
          document.getElementById('update-direccion').value = direccion;

          var updateSection = document.getElementById(clienteId + '-update-section');
          if (updateSection) {
              updateSection.style.display = 'block';
          }
    }
  </script>

  <script>
    function updateRow(clienteId) {
        var index = clienteId.split('-')[1]; // Añade esta línea para obtener el índice
  var nuevoId = document.getElementById('update-id').value;
  var nuevoNit = document.getElementById('update-nit').value;
  var nuevoNombre = document.getElementById('update-nombre').value;
  var nuevoMail = document.getElementById('update-mail').value;
  var nuevoPhone = document.getElementById('update-phone').value;
  var nuevaDireccion = document.getElementById('update-direccion').value;

        console.log('Updating row:', clienteId);
        console.log('New values:', nuevoId, ,nuevoNit,nuevoNombre, nuevoMail, nuevoPhone, nuevaDireccion);

        var row = document.getElementById(clienteId);
        row.cells[0].innerText = nuevoId;
        row.cells[1].innerText = nuevoNit;
        row.cells[2].innerText = nuevoNombre;
        row.cells[3].innerText = nuevoMail;
        row.cells[4].innerText = nuevoPhone;
        row.cells[5].innerText = nuevaDireccion;

        var updateSection = document.getElementById(clienteId + '-update-section');
        if (updateSection) {
            updateSection.style.display = 'none';
        }
    }
</script>

<script>
      function consultarDatos() {
          var fileInput = document.getElementById('formFile');
          var file = fileInput.files[0];

          if (file) {
              var reader = new FileReader();

              reader.onload = function (e) {
                  var xmlString = e.target.result;
                  procesarXML(xmlString);
              };

              reader.readAsText(file);
          } else {
              alert('Por favor, selecciona un archivo XML primero.');
          }
      }
      function procesarXML(xmlString) {
          var parser = new DOMParser();
          var xmlDoc = parser.parseFromString(xmlString, 'text/xml');

         
          clearTable();

          var clientes = xmlDoc.getElementsByTagName('cliente');
          for (var i = 0; i < clientes.length; i++) {
              var cliente = clientes[i];
              var id = cliente.getElementsByTagName('id')[0].textContent;
              var nit = cliente.getElementsByTagName('nit')[0].textContent;
              var nombre = cliente.getElementsByTagName('nombre')[0].textContent;                
              var mail = cliente.getElementsByTagName('mail')[0].textContent;
              var phone = cliente.getElementsByTagName('phone')[0].textContent;
              var direccion = cliente.getElementsByTagName('direccion')[0].textContent;

              addRowToTable(id, nit, nombre, mail, phone, direccion, i);
          }
          alert('Datos del XML consultados exitosamente');
      }

      function clearTable() {
          var table = document.getElementById('clientes-table');
          var tbody = table.getElementsByTagName('tbody')[0];
          tbody.innerHTML = ''; 
      }

      function addRowToTable(id, nit, nombre, mail, phone, direccion, index) {
          var table = document.getElementById('clientes-table');
          var tbody = table.getElementsByTagName('tbody')[0];
          var newRow = tbody.insertRow(tbody.rows.length);
          var cell1 = newRow.insertCell(0);
          var cell2 = newRow.insertCell(1);
          var cell3 = newRow.insertCell(2);
          var cell4 = newRow.insertCell(3);
          var cell5 = newRow.insertCell(4);
          var cell6 = newRow.insertCell(5);
          var cell7 = newRow.insertCell(6);
      
          newRow.id = 'cliente-' + index;
      
          cell1.innerText = id;
          cell2.innerText = nit;
          cell3.innerText = nombre;
          cell4.innerText = mail;
          cell5.innerText = phone;
          cell6.innerText = direccion;
      
          cell7.innerHTML = '<button onclick="showUpdateForm(' + index + ')">Editar</button>' +
          '<button onclick="deleteRow(\'' + newRow.id + '\')">Eliminar</button>';
      }

  </script>

<script>
    function deleteRow(clienteId) {
        var row = document.getElementById(clienteId);
        if (row) {
            console.log('Eliminando fila:', clienteId);
            row.parentNode.removeChild(row);
        } else {
            console.error('No se encontró la fila con el identificador:', clienteId);
        }
    }
</script>

<script>
      function showClientes() {
          var clientesSection = document.getElementById("clientes-section");
          var fileUploadSection = document.getElementById("file-upload-section");
          var additionalButtonsSection = document.getElementById("additional-buttons-section");

          if (clientesSection.style.display === "none" || clientesSection.style.display === "") {
              clientesSection.style.display = "block";
              fileUploadSection.style.display = "block";
              additionalButtonsSection.style.display = "block";
          } else {
              clientesSection.style.display = "none";
              fileUploadSection.style.display = "none";
              additionalButtonsSection.style.display = "none";
          }
      }
</script> 

  <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
          crossorigin="anonymous"
        ></script>
      


    {% block body %}
   
    {% endblock %}

  <script>

    function exportar(filename) {
        //parseamos los datos de la tabla a un xml 
        var xml = '<?xml version="1.0" encoding="UTF-8"?>\n<clientes>\n';
        var rows = document.querySelectorAll('table tbody tr');
    
        for (var i = 0; i < rows.length; i++) {
            xml += '  <cliente>\n';
            var cols = rows[i].querySelectorAll('td');
    
            // en este for el -1 hace que no se muestre la la parte de elimar/Agregar  y va agregando cada linea del xml basado en la tabla
            for (var j = 0; j < cols.length -1; j++) {
                var columna = document.querySelectorAll('table thead th')[j].innerText;
                xml += '    <' + columna.toLowerCase().replace(' ', '_') + '>' + cols[j].innerText + '</' + columna.toLowerCase().replace(' ', '_') + '>\n';
            }
    
            xml += '  </cliente>\n';
        }
    
        xml += '</clientes>';
    
        // Descargar el archivo XML
       descargar(xml, filename);
    }
    
    function descargar(xml, filename) {
        var xmlFile;
        var downloadLink;
    
        xmlFile = new Blob([xml], {type: 'application/xml'});
        downloadLink = document.createElement('a');
        downloadLink.download = filename;
        downloadLink.href = window.URL.createObjectURL(xmlFile);
        downloadLink.style.display = 'none';
        document.body.appendChild(downloadLink);
        downloadLink.click();
    }
    


  </script>
    
<!-
  acá debe ir el footer pero lo quite porque no me deja ver bien las tablas 
–>
</body>
</html>