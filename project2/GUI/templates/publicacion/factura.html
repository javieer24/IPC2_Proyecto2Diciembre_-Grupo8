{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>
    <link rel="icono" href="{% static 'logo.png' %}">
    <script src="https://kit.fontawesome.com/eb496ab1a0.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'plantilla.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
</head>
<body>
  
    <nav class="navbar navbar-expand-lg bg-dark">
        <div class="container-fluid">
          <img src="{% static 'logo3.png' %}" alt="" width="130" height="70">
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="nav justify-content-center">
              <li class="nav-item">
                
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="{% url 'Inicio' %}" style="color:#fff;" >Inicio</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:#fff;" >
                  Ayuda
                </a>
                <ul class="dropdown-menu">

                  <li><a class="dropdown-item" href="{% url 'Documentacion' %}">Documentación</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{% url 'Home' %}">Salir</a></li>   
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <br>

    <a href="{% url 'Clientes' %}" class="btn btn-primary">Clientes</a>
    <a href="{% url 'Productos' %}" class="btn btn-primary">Productos</a>
    <button type="button" class="btn btn-primary" onclick="showFacturas()">Factura</button>

    <div class="mb-3" id="file-upload-section" style="display: none;">
        <label for="formFile" class="form-label">Cargar archivo de entrada</label>
        <input class="form-control" type="file" id="formFile" style="width: 21.5%; display: inline-block;">
    </div>
    
    <div class="col-12 button-container" id="additional-buttons-section" style="display: none;">
        <button type="button" class="btn btn-success" onclick="consultarDatos()">Consultar datos</button>
        <button type="button" class="btn btn-danger"><a href="{% url 'Inicio' %}" style="text-decoration: none; color: white;">Regresar</a></button>
    </div>

    <div id="maestro-factura-section" style="display: none;">
        <h2>Maestro de Factura</h2>
        <div>
            <label for="nit">NIT:</label>
            <input type="text" id="nit" readonly>
        </div>
        <div>
            <label for="nombre-cliente">Nombre Cliente:</label>
            <input type="text" id="nombre-cliente" readonly>
        </div>
        <div>
            <label for="direccion">Dirección:</label>
            <input type="text" id="direccion" readonly>
        </div>
    </div>
    
    <div id="detalle-factura-section" style="display: none;">
        <h2>Detalle de Factura</h2>
        <table class="table" id="detalle-factura-table">
            <thead>
                <tr>
                    <th>Nombre del Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                </tr>
            </thead>
            <tbody id="detalle-factura-tbody"></tbody>
        </table>
    </div>

    <script>
          
      
    function addFacturaRow() {
        var nitCliente = document.getElementById('nit-cliente').value;
        var nombreCliente = document.getElementById('nombre-cliente').value;
        var direccionCliente = document.getElementById('direccion-cliente').value;

        if (!nitCliente || !nombreCliente || !direccionCliente) {
            alert('Todos los campos del maestro de factura son obligatorios');
            return;
        }

        var facturaTable = document.getElementById('factura-table');
        var facturaNewRow = facturaTable.insertRow(facturaTable.rows.length);
        var facturaCell1 = facturaNewRow.insertCell(0);
        var facturaCell2 = facturaNewRow.insertCell(1);
        var facturaCell3 = facturaNewRow.insertCell(2);
        var facturaCell4 = facturaNewRow.insertCell(3);

        facturaNewRow.id = 'factura-' + (facturaTable.rows.length - 1);

        facturaCell1.innerText = nitCliente;
        facturaCell2.innerText = nombreCliente;
        facturaCell3.innerText = direccionCliente;

        facturaCell4.innerHTML = '<table id="detalle-factura-' + (facturaTable.rows.length - 1) + '-table">' +
            '<thead><tr><th>Nombre Producto</th><th>Cantidad</th><th>Precio</th><th>Acciones</th></tr></thead>' +
            '<tbody></tbody></table>' +
            '<form onsubmit="addDetalleFacturaRow(\'' + facturaNewRow.id + '\'); return false;">' +
            '<label for="nombre-producto">Nombre Producto:</label><br>' +
            '<input type="text" id="nombre-producto" name="nombre-producto" required><br>' +
            '<label for="cantidad">Cantidad:</label><br>' +
            '<input type="number" id="cantidad" name="cantidad" required><br>' +
            '<label for="precio">Precio:</label><br>' +
            '<input type="number" id="precio" name="precio" required><br>' +
            '<input type="submit" value="Agregar Detalle">' +
            '</form>';

        alert('Factura agregada exitosamente');

        document.getElementById('nit-cliente').value = '';
        document.getElementById('nombre-cliente').value = '';
        document.getElementById('direccion-cliente').value = '';
    }

        function addDetalleFacturaRow(facturaId) {
            var nombreProducto = document.getElementById('nombre-producto').value;
            var cantidad = document.getElementById('cantidad').value;
            var precio = document.getElementById('precio').value;

            if (!nombreProducto || !cantidad || !precio) {
                alert('Todos los campos del detalle de factura son obligatorios');
                return;
            }

            var detalleTableId = 'detalle-' + facturaId;
            var detalleTable = document.getElementById(detalleTableId + '-table');

            var detalleNewRow = detalleTable.insertRow(detalleTable.rows.length);
            var detalleCell1 = detalleNewRow.insertCell(0);
            var detalleCell2 = detalleNewRow.insertCell(1);
            var detalleCell3 = detalleNewRow.insertCell(2);
            var detalleCell4 = detalleNewRow.insertCell(3);

            detalleNewRow.id = detalleTableId + '-' + (detalleTable.rows.length - 1);

            detalleCell1.innerText = nombreProducto;
            detalleCell2.innerText = cantidad;
            detalleCell3.innerText = precio;

            detalleCell4.innerHTML = '<button onclick="deleteDetalleRow(\'' + detalleNewRow.id + '\')">Eliminar</button>';
        }

        function deleteDetalleRow(detalleId) {
            var detalleRow = document.getElementById(detalleId);
            if (detalleRow) {
                console.log('Eliminando fila del detalle:', detalleId);
                detalleRow.parentNode.removeChild(detalleRow);
            } else {
                console.error('No se encontró la fila del detalle con el identificador:', detalleId);
            }
        }


    </script>

        
    </div>

    <script>
        function showUpdateForm(facturaId) {
            var facturaRow = document.getElementById(facturaId);
    
            var nitCliente = facturaRow.cells[0].innerText;
            var nombreCliente = facturaRow.cells[1].innerText;
            var direccionCliente = facturaRow.cells[2].innerText;
    
            document.getElementById('update-nit-cliente').value = nitCliente;
            document.getElementById('update-nombre-cliente').value = nombreCliente;
            document.getElementById('update-direccion-cliente').value = direccionCliente;
    
            var detalleRow = facturaRow.getElementsByTagName('tr')[1]; 
            var nombreProducto = detalleRow.cells[0].innerText;
            var cantidadProducto = detalleRow.cells[1].innerText;
            var precioProducto = detalleRow.cells[2].innerText;
    
            document.getElementById('update-nombre-producto').value = nombreProducto;
            document.getElementById('update-cantidad-producto').value = cantidadProducto;
            document.getElementById('update-precio-producto').value = precioProducto;
    
            var updateSection = document.getElementById(facturaId + '-update-section');
            if (updateSection) {
                updateSection.style.display = 'block';
            }
        }
    </script>

    <script>
        function updateFacturaRow(facturaId) {
            var nuevoNitCliente = document.getElementById('update-nit-cliente').value;
            var nuevoNombreCliente = document.getElementById('update-nombre-cliente').value;
            var nuevaDireccionCliente = document.getElementById('update-direccion-cliente').value;
    
            console.log('Updating factura row:', facturaId);
            console.log('New values (maestro):', nuevoNitCliente, nuevoNombreCliente, nuevaDireccionCliente);
    
            var facturaRow = document.getElementById(facturaId);
    
            facturaRow.cells[0].innerText = nuevoNitCliente;
            facturaRow.cells[1].innerText = nuevoNombreCliente;
            facturaRow.cells[2].innerText = nuevaDireccionCliente;
    
            var detalleRow = facturaRow.getElementsByTagName('tr')[1]; 
    
            var nuevoNombreProducto = document.getElementById('update-nombre-producto').value;
            var nuevoCantidadProducto = document.getElementById('update-cantidad-producto').value;
            var nuevoPrecioProducto = document.getElementById('update-precio-producto').value;
    
            console.log('New values (detalle):', nuevoNombreProducto, nuevoCantidadProducto, nuevoPrecioProducto);
    
            detalleRow.cells[0].innerText = nuevoNombreProducto;
            detalleRow.cells[1].innerText = nuevoCantidadProducto;
            detalleRow.cells[2].innerText = nuevoPrecioProducto;
    
            var updateSection = document.getElementById(facturaId + '-update-section');
            if (updateSection) {
                updateSection.style.display = 'none';
            }
        }
    </script>

    <script>
        function consultarDatos() {
            var fileInput = document.getElementById('formFile');
            var file = fileInput.files[0];
    
            if (file) {
                var reader = new FileReader();
    
                reader.onload = function (e) {
                    var xmlString = e.target.result;
                    procesarXML(xmlString);
                };
    
                reader.readAsText(file);
            } else {
                alert('Por favor, selecciona un archivo XML primero.');
            }
        }
    
        function procesarXML(xmlString) {
            var parser = new DOMParser();
            var xmlDoc = parser.parseFromString(xmlString, 'text/xml');
    
           clearTable();
    
            var facturas = xmlDoc.getElementsByTagName('factura');
    
            for (var i = 0; i < facturas.length; i++) {
                var factura = facturas[i];
                var nitCliente = factura.getElementsByTagName('nitCliente')[0].textContent;
                var nombreCliente = factura.getElementsByTagName('nombreCliente')[0].textContent;
                var direccionCliente = factura.getElementsByTagName('direccionCliente')[0].textContent;
    
                addMaestroRowToTable(nitCliente, nombreCliente, direccionCliente, i);
    
                var detalles = factura.getElementsByTagName('detalle');
    
                for (var j = 0; j < detalles.length; j++) {
                    var detalle = detalles[j];
                    var nombreProducto = detalle.getElementsByTagName('nombreProducto')[0].textContent;
                    var cantidadProducto = detalle.getElementsByTagName('cantidadProducto')[0].textContent;
                    var precioProducto = detalle.getElementsByTagName('precioProducto')[0].textContent;
    
                    addDetalleRowToTable(nombreProducto, cantidadProducto, precioProducto, i, j);
                }
            }
    
            alert('Datos del XML de factura consultados exitosamente');
        }
    
        function clearTable() {
            var table = document.getElementById('facturas-table');
            var tbody = table.getElementsByTagName('tbody')[0];
            tbody.innerHTML = ''; 
        }
    
        function addMaestroRowToTable(nitCliente, nombreCliente, direccionCliente, index) {
            var table = document.getElementById('facturas-table');
            var tbody = table.getElementsByTagName('tbody')[0];
            var newRow = tbody.insertRow(tbody.rows.length);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);
            var cell4 = newRow.insertCell(3);
    
            newRow.id = 'factura-maestro-' + index;
    
            cell1.innerText = nitCliente;
            cell2.innerText = nombreCliente;
            cell3.innerText = direccionCliente;
    
            cell4.innerHTML = '<button onclick="showUpdateForm(\'' + newRow.id + '\')">Editar Maestro</button>' +
                '<button onclick="deleteRow(\'' + newRow.id + '\')">Eliminar Maestro</button>';
        }
    
        function addDetalleRowToTable(nombreProducto, cantidadProducto, precioProducto, maestroIndex, detalleIndex) {
            var maestroRowId = 'factura-maestro-' + maestroIndex;
            var maestroRow = document.getElementById(maestroRowId);
    
            var detalleTable = maestroRow.querySelector('.detalle-table');
            var detalleTbody = detalleTable.getElementsByTagName('tbody')[0];
            var newDetalleRow = detalleTbody.insertRow(detalleTbody.rows.length);
            var cell1 = newDetalleRow.insertCell(0);
            var cell2 = newDetalleRow.insertCell(1);
            var cell3 = newDetalleRow.insertCell(2);
            var cell4 = newDetalleRow.insertCell(3);
    
            newDetalleRow.id = 'factura-detalle-' + maestroIndex + '-' + detalleIndex;
    
            cell1.innerText = nombreProducto;
            cell2.innerText = cantidadProducto;
            cell3.innerText = precioProducto;
    
            cell4.innerHTML = '<button onclick="showUpdateDetalleForm(\'' + newDetalleRow.id + '\')">Editar Detalle</button>' +
                '<button onclick="deleteRow(\'' + newDetalleRow.id + '\')">Eliminar Detalle</button>';
        }
    
        function showUpdateForm(facturaMaestroId) {
            var facturaMaestroRow = document.getElementById(facturaMaestroId);
    
            var nitCliente = facturaMaestroRow.cells[0].innerText;
            var nombreCliente = facturaMaestroRow.cells[1].innerText;
            var direccionCliente = facturaMaestroRow.cells[2].innerText;
    
            document.getElementById('update-nit-cliente').value = nitCliente;
            document.getElementById('update-nombre-cliente').value = nombreCliente;
            document.getElementById('update-direccion-cliente').value = direccionCliente;
    
            var updateSection = document.getElementById(facturaMaestroId + '-update-section');
            if (updateSection) {
                updateSection.style.display = 'block';
            }
        }
    
        function showUpdateDetalleForm(facturaDetalleId) {
            var facturaDetalleRow = document.getElementById(facturaDetalleId);
    
            var nombreProducto = facturaDetalleRow.cells[0].innerText;
            var cantidadProducto = facturaDetalleRow.cells[1].innerText;
            var precioProducto = facturaDetalleRow.cells[2].innerText;
    
            document.getElementById('update-nombre-producto').value = nombreProducto;
            document.getElementById('update-cantidad-producto').value = cantidadProducto;
            document.getElementById('update-precio-producto').value = precioProducto;
            var updateDetalleSection = document.getElementById(facturaDetalleId + '-update-section');
            if (updateDetalleSection) {
                updateDetalleSection.style.display = 'block';
            }
        }
    </script>
  
    <script>
        function deleteRow(facturaMaestroId) {
            var facturaMaestroRow = document.getElementById(facturaMaestroId);
            if (facturaMaestroRow) {
                console.log('Eliminando fila del maestro:', facturaMaestroId);
                facturaMaestroRow.parentNode.removeChild(facturaMaestroRow);
            } else {
                console.error('No se encontró la fila del maestro con el identificador:', facturaMaestroId);
            }
        }
    </script>
    
    <script>
        function showFacturas() {
            var facturasSection = document.getElementById("facturas-section");
            var fileUploadSection = document.getElementById("file-upload-section");
            var additionalButtonsSection = document.getElementById("additional-buttons-section");
    
            if (facturasSection.style.display === "none" || facturasSection.style.display === "") {
                facturasSection.style.display = "block";
                fileUploadSection.style.display = "block";
                additionalButtonsSection.style.display = "block";
            } else {
                facturasSection.style.display = "none";
                fileUploadSection.style.display = "none";
                additionalButtonsSection.style.display = "none";
            }
        }
    </script>
  

  <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
          crossorigin="anonymous"
        ></script>
      


    {% block body %}
   
    {% endblock %}
    
    <footer class="pie-pagina">
      <div class="grupo-1">
          <div class="box">
              <figure>
                  <a href="{% url 'Home' %}">
                      <img src="{% static 'logo.png' %}" alt="Logo Grupo8">
                  </a>
              </figure>
          </div>
          <div class="box">
              <h2>SOBRE NOSOTROS</h2>
              <p>Somos una red social capaz de desarrollar y analizar el contenido de nuestros usuarios. </p>
              <p>Establecemos perfiles que favorezcan a conocer a todos nuestros usuarios y brindar un servicio personalizado.</p>
          </div>
          <div class="box">
              <h2>SIGUENOS</h2>
              <div class="red-social">
                  <a href="#" class="fa fa-facebook"></a>
                  <a href="#" class="fa fa-instagram"></a>
                  <a href="#" class="fa fa-twitter"></a>
                  <a href="#" class="fa fa-youtube"></a>
              </div>
          </div>
      </div>
      <div class="grupo-2">
          <small>&copy; 2023 <b>Proyecto 2-Grupo 8 S.A.</b> - Todos los Derechos Reservados.</small>
      </div>
    </footer>
    
</body>
</html>